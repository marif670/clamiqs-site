<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calmiqs Blog Post</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#4FA49A",
              accent: "#FFD580",
              tech: "#5A67D8",
            },
            fontFamily: { sans: ["Poppins", "sans-serif"] },
          },
        },
      };
    </script>

    <link rel="stylesheet" href="/assets/css/style.css?v=12" />
  </head>

  <body class="font-sans bg-[#F9FAFB] text-gray-800">
    <!-- HEADER -->
    <div id="navbar-container"></div>

    <main class="max-w-4xl mx-auto py-16 px-6">
      <div id="postContainer" class="text-center"></div>
      <div id="postNav" class="flex justify-between mt-12"></div>
    </main>

    <footer class="bg-gray-100 py-8 mt-16 text-center text-gray-600">
      <p>© 2025 Calmiqs — Wellness Meets Sustainability</p>
    </footer>

    <script>
      (async () => {
        const postContainer = document.getElementById("postContainer");
        const postNav = document.getElementById("postNav");

        // Fallback embedded posts
        const embeddedPosts = {
          "mindful-breathing": {
            title: "The Art of Mindful Breathing",
            date: "November 2, 2025",
            image: "https://via.placeholder.com/800x400?text=Mindful+Breathing",
            content: `
              <p>Mindful breathing allows you to focus on your breath and anchor your thoughts in the present moment. This practice reduces stress, anxiety, and improves focus.</p>
              <p class="mt-4">Start by taking deep, slow breaths, observing each inhale and exhale. Feel the air as it enters and leaves your body, grounding you in calm awareness.</p>
            `,
          },
          "eco-habits": {
            title: "5 Small Eco Habits That Reduce Stress",
            date: "November 4, 2025",
            image: "https://via.placeholder.com/800x400?text=Eco+Habits",
            content: `
              <p>Living sustainably doesn't have to be overwhelming. By making small eco-friendly changes, you can create a lifestyle that supports both the planet and your mental well-being.</p>
              <ul class="list-disc ml-6 mt-4 text-left">
                <li>Practice digital detoxes to save energy and reduce stress.</li>
                <li>Walk or cycle instead of driving short distances.</li>
                <li>Start composting to reconnect with nature.</li>
                <li>Use reusable water bottles and cups.</li>
                <li>Spend time in green spaces daily.</li>
              </ul>
            `,
          },
        };

        // Load posts from KV
        async function loadPosts() {
          try {
            const res = await fetch("/posts"); // KV endpoint
            if (!res.ok) throw new Error("KV fetch failed");
            return await res.json();
          } catch (err) {
            console.error("KV fetch failed, using fallback:", err);
            return embeddedPosts;
          }
        }

        const posts = await loadPosts();

        // Get post key from URL
        const params = new URLSearchParams(window.location.search);
        const keys = Object.keys(posts);
        const key = params.get("post") || keys[0];
        const post = posts[key];

        if (!post) {
          postContainer.innerHTML = `<p class="text-gray-500">Post not found.</p>`;
          return;
        }

        postContainer.innerHTML = `
          <h1 class="text-4xl font-bold text-primary mb-4">${post.title}</h1>
          <p class="text-gray-500 mb-6">${post.date}</p>
          <img src="${post.image}" alt="${
          post.imageAlt || post.title
        }" class="rounded-xl mb-8 shadow-lg mx-auto" />
          <div class="text-lg leading-relaxed text-left max-w-3xl mx-auto">${post.content}</div>
          <div class="mt-10 text-center">
            <a href="blog.html"
               class="inline-block bg-primary text-white px-6 py-3 rounded-xl font-medium hover:bg-accent transition shadow">
               ← Back to Blog
            </a>
          </div>
        `;

        // Previous / Next navigation
        const currentIndex = keys.indexOf(key);
        const prevKey = keys[currentIndex - 1];
        const nextKey = keys[currentIndex + 1];

        postNav.innerHTML = `
          <div>
            ${
              prevKey
                ? `<a href="post-template.html?post=${prevKey}" class="text-primary hover:underline">← ${posts[prevKey].title}</a>`
                : ""
            }
          </div>
          <div>
            ${
              nextKey
                ? `<a href="post-template.html?post=${nextKey}" class="text-primary hover:underline">${posts[nextKey].title} →</a>`
                : ""
            }
          </div>
        `;
      })();
    </script>
    <!-- Global scripts -->
    <script src="/assets/js/auth.js"></script>
    <script src="/assets/js/header-loader.js"></script>
  </body>
</html>
